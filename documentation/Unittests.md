Unittests
---------
Saffire tries to do as much unittesting as possible. There are two different ways to unittest:

  - Through .sfu files
  - Through CUnit

With CUnit, we test internal core code like hashtables, dlls, memory management etc. The SFU files are highlevel
unittests where the tests have been writting in Saffire.

Running CUnit unittests
-----------------------
You can run the CUnit tests through the following command:

    ./build/release/utmain

Running SFU tests
-----------------
You can run the SFU testsuite through the following command:

    sh unittest.sh
    
    
Writing SFU unittests
---------------------
Saffire unittests are modelled after the PHP unit tests system (phpt)

Each file with the extension `sfu` has the following format:

     header
     ****
     test 1 code
     ---- (or ~~~~)
     test 1 output
     @@@@
     test 2 code
     ---- (or ~~~~)
     test 2 output
     @@@@
     ....
     


### Header ###
A header consists of information like `title`, `author` etc. It will be ended with four or more `*`

      title: An example unit tests
      author: jthijssen@saffire-lang.org
      *********

The `title` tag will be used for displaying what the unit-tests does during the unit-testing. More information can be added to the header, but is not mandatory.

### Body ###
A SFU file contains zero or more tests. Each test is separated by four or more `@`:

      title: An example unit tests
      author: jthijssen@saffire-lang.org
      *********
      test-details 1
      @@@@
      test-details 2
      @@@@
      test-details 3
      @@@@
      test-details 4
    
The last test does not have to end with `@@@@`.

### Details ####
Each test consists of two separate parts as well: a code block and an output block. the code block is the code that is actually run by Saffire. It will be completely separate from other tests so it must be self-sufficient (for instance: if you are printing data, you MUST import the `io` module.

The output block is the result that the saffire codeblock MUST output. If the output of the saffire code does not correspond to the output block, the test is assumed to have failed.

      
      title: An example unit tests
      author: jthijssen@saffire-lang.org
      *********
      import io;
      io.print("hello\nworld\n");
      -----
      hello
      world
      
The code and output is separated by at least four `-` marks.

Note that every line in the output must exactly match the line generated by the code. The system uses a `diff` system to match the results.

### Testing for partial output ###
It's possible that you don't always want to the whole output (for instance, in case of exceptions), but only a part. For instance, if an exception message is present. This makes it easier to make more robust tests, when saffire generated output changes. 

In order to check for partial content, use the `~~~~` separator instead of the `----` separator between saffire code and output.

      import io;
      t = tuple[["foo", "bar", "baz"]];
      io.print(t.get(3), "\n");
      ~~~~
      Index out of range

As long as the output contains `Index out of range` somewhere (it doesn't even need to be at the start of the line, for instance), it will pass the test.



### Multiple tests ###
It's possible to add multiple tests to each SFU tests. This makes it easier to group multiple of the same tests together. Most likely, you are testing on a specific functionality (ie: `strings`), where you can group different string functionality together. Most of these tests are stored in files called `strings-001.sfu`, `strings-002.sfu` etc..

The output of the unit-tester will group every 10 tests together. 
